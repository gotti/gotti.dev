<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/f7694684bafa1b63.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f7694684bafa1b63.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-950829b7c220163d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b73741786cd71641.js" defer=""></script><script src="/_next/static/chunks/441-cface77118a36673.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Barticle%5D-570933cadfce4296.js" defer=""></script><script src="/_next/static/yNUj7Y4cyPvjN1GaMlLf8/_buildManifest.js" defer=""></script><script src="/_next/static/yNUj7Y4cyPvjN1GaMlLf8/_ssgManifest.js" defer=""></script><script src="/_next/static/yNUj7Y4cyPvjN1GaMlLf8/_middlewareManifest.js" defer=""></script></head><body class="Body"><div class="Menu"><ul><li><a href="/">Home</a></li><li><a href="/post/">Post</a></li></ul></div><div class="Home"><div id="__next" data-reactroot=""><div class="postBody"><div><h2 id="はじめに">はじめに</h2>
<p>これはUEC 2 Advent Calendar 2021の12/14の記事です。前の方は12/13にpizacさんが投稿している<a href="https://pizac.hatenablog.com/entry/2021/12/13/145722">外付けSSDにUbuntuをインストールした話</a>です。</p>
<p>USBメモリにLinux入れとくの便利ですよね。わたしの推しのArch Linuxは<a href="https://wiki.archlinux.jp/index.php/%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%81%AB_Arch_Linux_%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">wikiにUSBメモリにインストールする方法が載ってたりします</a>。わたしもPCが死んだときの復旧に重宝しています。</p>
<h2 id="自己紹介">自己紹介</h2>
<p>uec20のごっちです。12/13の23:30ごろに急に記事書きてえなとなり12/14のadvent calendar枠を確保して頑張って書いています。</p>
<p>ところでみなさんも一度は家庭用ルータではできない複雑なルーティングをしたりVPNを張りまくったりしたくなりますよね。</p>
<p>ルータ用OSとして有名なものとして、家庭用ルータに焼けるOpenWrtなどもあります。</p>
<p>しかし組み込み機器向けなOSなので(わたしは)かなりつらくなって嫌になりました。そこでVyOSです。</p>
<h2 id="特徴">特徴</h2>
<p>VyOSはその名の通りOSで、x86_64のパソコンにインストールして使います。debianベースらしいです。</p>
<h3 id="利点">利点</h3>
<ul>
<li>家庭用ルータのCPUとは比べものにならないx86_64の性能で殴れます</li>
<li>VPNにいろいろ対応しています。WireGuardやOpenVPN、L2TPなどなど</li>
<li>ansibleから叩くことでデプロイを自動化できます</li>
<li>コマンド書式が綺麗</li>
</ul>
<h3 id="欠点">欠点</h3>
<ul>
<li>x86_64機用意するのめんどい</li>
<li>用途によってはtoo muchなことも多い</li>
</ul>
<h2 id="やっていく">やっていく</h2>
<p>ある用途にOpenVPNのサーバが欲しくなったのと強いソフトウェアルータを触ってみたかったなどがありVyOSを使っていくことにしました。</p>
<p>インストールですが、VyOSはLTSが有償という謎なライセンス体系です。snapshotとnightly buildsは無償です。snapshotをダウンロードしましょう。</p>
<p><a href="https://vyos.net/get/">https://vyos.net/get/</a></p>
<p>インストール手順は解説しません。公式ドキュメントを見てください。</p>
<p><a href="https://docs.vyos.io/en/equuleus/installation/index.html">https://docs.vyos.io/en/equuleus/installation/index.html</a></p>
<p>これはQuick Start Guideです。コマンドが良い感じなのがわかりますね。コマンドで設定するタイプのルータを触ったことがある人は雰囲気で触れるはず。</p>
<p><a href="https://docs.vyos.io/en/equuleus/quick-start.html">https://docs.vyos.io/en/equuleus/quick-start.html</a></p>
<p>ユーザーを追加してファイアウォールなどを設定したらansibleもやっていきましょう。</p>
<h3 id="memo">memo</h3>
<p>ところで私はNTTPC Indigoの350円/月なVPSサーバにVyOSをインストールしました。このVPSはUbuntuとCentOSとWindowsしか動かせないのですが、黒魔術を使うとVyOSを起動できます。</p>
<p><a href="https://scrapbox.io/otofune/NTTPC_Indigo_%E3%81%A7_OS_%E3%82%92%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B">https://scrapbox.io/otofune/NTTPC_Indigo_%E3%81%A7_OS_%E3%82%92%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B</a></p>
<p>ubuntu20だからかsnapshotで不適切なのを選んだからか、いくつかの組み合せではカーネルパニックが起きて失敗しました。これをやる際はいろいろな組み合わせを試してみてください。ちなみにVyOSはqcow2イメージも配っています、優しい。</p>
<h2 id="ansible">ansible</h2>
<p>また実際のコードは置きません。ドキュメントはこれです。</p>
<p><a href="https://docs.vyos.io/en/equuleus/automation/vyos-ansible.html">https://docs.vyos.io/en/equuleus/automation/vyos-ansible.html</a></p>
<p>コマンド列挙するだけなんですが自動化できるのは良いことです。私はGitHubに適用するコマンドを列挙してGitHub Actionsでansibleを叩いてデプロイするようにしています。</p>
</div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"page":"\n## はじめに\n\nこれはUEC 2 Advent Calendar 2021の12/14の記事です。前の方は12/13にpizacさんが投稿している[外付けSSDにUbuntuをインストールした話](https://pizac.hatenablog.com/entry/2021/12/13/145722)です。\n\nUSBメモリにLinux入れとくの便利ですよね。わたしの推しのArch Linuxは[wikiにUSBメモリにインストールする方法が載ってたりします](https://wiki.archlinux.jp/index.php/%E3%83%AA%E3%83%A0%E3%83%BC%E3%83%90%E3%83%96%E3%83%AB%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%81%AB_Arch_Linux_%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB)。わたしもPCが死んだときの復旧に重宝しています。\n\n## 自己紹介\n\nuec20のごっちです。12/13の23:30ごろに急に記事書きてえなとなり12/14のadvent calendar枠を確保して頑張って書いています。\n\nところでみなさんも一度は家庭用ルータではできない複雑なルーティングをしたりVPNを張りまくったりしたくなりますよね。\n\nルータ用OSとして有名なものとして、家庭用ルータに焼けるOpenWrtなどもあります。\n\nしかし組み込み機器向けなOSなので(わたしは)かなりつらくなって嫌になりました。そこでVyOSです。\n\n## 特徴\n\nVyOSはその名の通りOSで、x86_64のパソコンにインストールして使います。debianベースらしいです。\n\n### 利点\n\n- 家庭用ルータのCPUとは比べものにならないx86_64の性能で殴れます\n- VPNにいろいろ対応しています。WireGuardやOpenVPN、L2TPなどなど\n- ansibleから叩くことでデプロイを自動化できます\n- コマンド書式が綺麗\n\n### 欠点\n\n- x86_64機用意するのめんどい\n- 用途によってはtoo muchなことも多い\n\n## やっていく\n\nある用途にOpenVPNのサーバが欲しくなったのと強いソフトウェアルータを触ってみたかったなどがありVyOSを使っていくことにしました。\n\nインストールですが、VyOSはLTSが有償という謎なライセンス体系です。snapshotとnightly buildsは無償です。snapshotをダウンロードしましょう。\n\nhttps://vyos.net/get/\n\nインストール手順は解説しません。公式ドキュメントを見てください。\n\nhttps://docs.vyos.io/en/equuleus/installation/index.html\n\nこれはQuick Start Guideです。コマンドが良い感じなのがわかりますね。コマンドで設定するタイプのルータを触ったことがある人は雰囲気で触れるはず。\n\nhttps://docs.vyos.io/en/equuleus/quick-start.html\n\nユーザーを追加してファイアウォールなどを設定したらansibleもやっていきましょう。\n\n### memo\n\nところで私はNTTPC Indigoの350円/月なVPSサーバにVyOSをインストールしました。このVPSはUbuntuとCentOSとWindowsしか動かせないのですが、黒魔術を使うとVyOSを起動できます。\n\nhttps://scrapbox.io/otofune/NTTPC_Indigo_%E3%81%A7_OS_%E3%82%92%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B\n\nubuntu20だからかsnapshotで不適切なのを選んだからか、いくつかの組み合せではカーネルパニックが起きて失敗しました。これをやる際はいろいろな組み合わせを試してみてください。ちなみにVyOSはqcow2イメージも配っています、優しい。\n\n## ansible\n\nまた実際のコードは置きません。ドキュメントはこれです。\n\nhttps://docs.vyos.io/en/equuleus/automation/vyos-ansible.html\n\nコマンド列挙するだけなんですが自動化できるのは良いことです。私はGitHubに適用するコマンドを列挙してGitHub Actionsでansibleを叩いてデプロイするようにしています。\n\n"},"__N_SSG":true},"page":"/post/[article]","query":{"article":"uecadvent2021_vyos"},"buildId":"yNUj7Y4cyPvjN1GaMlLf8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>